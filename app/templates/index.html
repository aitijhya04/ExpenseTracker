{% extends "base.html" %}
{% block content %}
<div style="display:flex; flex-direction:column; align-items:center; gap:2rem;">

  <!-- Add Expense Form -->
  <section class="form-section" style="width:100%; max-width:500px; text-align:center;">
    <h1>Add an Expense</h1>
    <form method="post" action="/api/add_expense" style="display:flex; flex-direction:column; gap:0.8rem;">
      <label>Amount:
        <input required name="amount" type="number" step="0.01">
      </label>

      <label>Currency:
        <select name="currency" required>
          <option value="INR">₹ INR</option>
          <option value="USD">$ USD</option>
          <option value="EUR">€ EUR</option>
          <option value="GBP">£ GBP</option>
          <option value="JPY">¥ JPY</option>
        </select>
      </label>

      <label>Category:
        <select required name="category">
          <option value="Food">Food</option>
          <option value="Utilities">Utilities</option>
          <option value="Rent">Rent</option>
          <option value="Travel">Travel</option>
          <option value="Lifestyle">Lifestyle</option>
          <option value="Groceries">Groceries</option>
          <option value="Entertainment">Entertainment</option>
          <option value="Healthcare">Healthcare</option>
          <option value="Education">Education</option>
          <option value="Savings">Savings</option>
          <option value="Miscellaneous">Miscellaneous</option>
        </select>
      </label>

      <label>Date:
        <input required name="date_str" type="date" max="{{ now().strftime('%Y-%m-%d') }}">
      </label>

      <label>Description:
        <input name="description" type="text">
      </label>

      <button type="submit" style="margin-left:10px; padding:4px 8px; font-size:0.9rem; width:auto;">Add Expense</button>
    </form>
  </section>

  <!-- Filters -->
  <section class="filter-section" style="width:100%; max-width:500px; text-align:center;">
    <h1>View Expenses</h1>
    <h2>Filter</h2>
    <form method="get" action="/" style="display:flex; flex-wrap:wrap; justify-content:center; gap:0.5rem; align-items:center;">
      <label>Category:
        <select name="category">
          <option value="">All</option>
          {% for c in categories %}
            <option value="{{ c }}">{{ c }}</option>
          {% endfor %}
        </select>
      </label>
      <label>Start: <input type="date" name="start"></label>
      <label>End: <input type="date" name="end"></label>
      <button type="submit" style="margin-top:0.5rem; padding:4px 8px; font-size:0.9rem; width:auto;">Add Filter</button>
    </form>
  </section>

  <!-- Summary -->
  <section class="summary" style="width:100%; max-width:500px; text-align:center; padding:0.25rem; border-radius:20px; background:#f3f4f6; box-shadow:0 3px 8px rgba(0,0,0,0.08);">
    <p style="font-size:2rem; font-weight:700; color:#2563eb;">Total Spends: ₹{{ "%.2f"|format(summary.total) }}</p>
    <p style="font-size:1.5rem;">Total Transactions: {{ summary.count if summary.count is defined else '-' }}</p>
    <ul style="list-style:none; padding:0; margin-top:1rem;">
      {% for cat, amt in summary.by_category.items() %}
        <li>{{ cat }}: ₹{{ "%.2f"|format(amt) }}</li>
      {% endfor %}
    </ul>
  </section>

  <!-- All Expenses Table -->
  <section class="table-section" style="width:100%; max-width:900px; text-align:center;">
    <h2>All Expenses</h2>
    <table style="margin:0 auto;">
      <thead><tr><th>#</th><th>Amount</th><th>Category</th><th>Date</th><th>Description</th><th>Added at</th></tr></thead>
      <tbody>
        {% for e in expenses %}
        <tr>
          <td>{{ e.id }}</td>
          <td>₹{{ "%.2f"|format(e.amount) }}</td>
          <td>{{ e.category }}</td>
          <td>{{ e.date }}</td>
          <td>{{ e.description or '' }}</td>
          <td>{{ e.created_at.strftime("%Y-%m-%d %H:%M:%S") }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </section>

</div>
{% endblock %}
